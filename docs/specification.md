Отлично, у нас есть вся необходимая информация для составления ТЗ. Ниже представлено **техническое задание** на разработку Python-скрипта для построения QQ-plot с учетом всех ваших требований.

---

## **Техническое задание: Скрипт для построения QQ-plot**

### **1. Цель**
Разработать Python-скрипт, который строит **QQ-plot** для выбранного столбца данных из файлов в папке `data` и сравнивает распределение с теоретическими моделями (нормальное, Берра, гамма, смесь распределений). Все параметры задаются через конфигурационный файл.

### **2. Входные данные**
- **Формат данных**: текстовые файлы (`YYYY.txt`) с фиксированным форматом (см. пример в `README`).
- **Структура данных**:
  - Колонки: `Year, Day, Hour, Minute, Scalar B, BX, BY, BZ, Flow speed, Vx, Vy, Vz`.
  - Пропуски обозначены значениями `99999.9` или `9999.99`.
- **Источник данных**: папка `./data`.

### **3. Требования к функционалу**
#### **3.1. Загрузка и обработка данных**
- Скрипт должен:
  - Читать **один файл** (если указан год) или **все файлы** (если `year: "all"`).
  - Извлекать указанный в конфиге столбец (напр., `Scalar B, nT`).
  - Игнорировать пропуски (`missing_values`).

#### **3.2. Построение QQ-plot**
- **Теоретические распределения**:
  - Нормальное (`scipy.stats.norm`).
  - Распределение Берра (`scipy.stats.burr`).
  - Гамма-распределение (`scipy.stats.gamma`).
  - Смесь распределений (например, `norm + gamma`).
- **Оценка параметров**:
  - Если `fit_from_data: true` — параметры оцениваются методом максимального правдоподобия (MLE).
  - Если `fit_from_data: false` — параметры берутся из конфига (`mean`, `std`, `loc`, `scale` и т.д.).

#### **3.3. Визуализация**
- **Обязательные элементы графика**:
  - Точки эмпирических vs. теоретических квантилей.
  - Линия `y = x` (если `show_line: true`).
  - Подписи осей (`xlabel`, `ylabel`).
- **Сохранение**:
  - Форматы: `PNG`, `PDF`, `SVG` (указывается в конфиге).
  - Путь: `./plots/` (или другой из `output_dir`).

#### **3.4. Интерфейс и конфигурация**
- **CLI-интерфейс**: скрипт запускается командой:
  ```bash
  python qq_plot.py --config=config.yaml
  ```
- **Конфигурационный файл** (`config.yaml`):
  ```yaml
  data:
    path: "./data"
    column: "Scalar B, nT"
    year: 2005               # или "all"
    missing_values: [9999.99, 99999.9]

  distribution:
    type: "normal"           # normal / burr / gamma / mixture
    fit_from_data: true       # оценивать параметры из данных
    parameters:               # (если fit_from_data=false)
      mean: 0
      std: 1
      c: 1.5                  # для Берра
      d: 2.0                  # для Берра

  plot:
    title: "QQ-plot для модуля ММП"
    xlabel: "Теоретические квантили"
    ylabel: "Экспериментальные квантили"
    show_line: true
    save_format: "png"
    output_dir: "./plots"
  ```

#### **3.5. Обработка ошибок и логирование**
- **Ошибки**:
  - Если файл не найден — сообщить и завершить работу.
  - Если в данных нет указанного столбца — сообщить и завершить работу.
  - Если параметры распределения невалидны — сообщить и завершить работу.
- **Логирование**:
  - Запись ключевых шагов (загрузка данных, построение графика) в файл `qq_plot.log`.

#### **3.6. Зависимости**
- Библиотеки:
  - `matplotlib` — визуализация.
  - `scipy` — работа с распределениями.
  - `numpy` — обработка данных.
  - `pyyaml` — чтение конфига.
  - `logging` — логирование.

### **4. Пример работы**

#### **Запуск**:
```bash
python qq_plot.py --config=config.yaml
```

#### **Результат**:
- Графики для каждого года в папке `./plots/`
- Имя графика формироуется по шаблону `QQ_<type>_<period>.png` (например `QQ_Burr_all.png`)

### **5. Тестирование**
- Проверить на:
  - Корректных данных (разные распределения).
  - Отсутствующем файле.
  - Некорректном столбце.
  - Пропусках в данных.

---

### **6. Дополнительные требования**
- **Код должен быть модульным** (функции для загрузки данных, подбора распределения, визуализации).
- **Документация**: описание функций в `docstrings`.
- **Совместимость**: Python 3.12+.